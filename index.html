<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Paperclip Torrent by fattymiller</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Paperclip Torrent</h1>
          <h2>Generate a .torrent file to compliment your paperclip upload</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/fattymiller/paperclip_torrent/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/fattymiller/paperclip_torrent/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/fattymiller/paperclip_torrent" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a name="papercliptorrent" class="anchor" href="#papercliptorrent"><span class="octicon octicon-link"></span></a>PaperclipTorrent</h1>

<p>Convert processed paperclip attachments in to a downloadable torrent file for later retrieval.</p>

<h2>
<a name="setup" class="anchor" href="#setup"><span class="octicon octicon-link"></span></a>Setup</h2>

<p>Currently PaperclipTorrent requires an edge version on Paperclip to support multiple style saving.</p>

<p>To use, add the following to your <strong>Gemfile</strong>:</p>

<pre><code>gem 'paperclip', github: "thoughtbot/paperclip"
gem 'paperclip_torrent', github: "fattymiller/paperclip_torrent"
</code></pre>

<p>In your model, setup your <code>has_attached_files</code> as normal, including the <code>:torrentify</code> processor like so:</p>

<pre><code>has_attached_file :attachment, { styles: {
  audio_128kbps_44100hz: { format: 'mp3', torrentify: true }, 
  hd_720p_16x9_5000kbps: { geometry: '1280x720', format: 'mp4', torrentify: true }, 

  preview_image: { geometry: '1024x768', format: 'jpg', time: 10 }
}, processors: [:ffmpeg, :qtfaststart, :torrentify] }
</code></pre>

<p>The above example shows three paperclip styles to be parsed by ffmpeg processors, two of which (based on the <code>torrentify: true</code> setting) will output torrent files.</p>

<p>To access your generated torrent files, create an <code>after_save</code> callback, and iterate over <code>&lt;attachment_field&gt;.torrent_results</code>.</p>

<h3>
<a name="optional" class="anchor" href="#optional"><span class="octicon octicon-link"></span></a>Optional</h3>

<p>Optionally, PaperclipTorrent can be setup to automatically save your torrent files against your model on save when new files are detected. To do so:</p>

<h4>
<a name="run-the-installer-and-migrate" class="anchor" href="#run-the-installer-and-migrate"><span class="octicon octicon-link"></span></a>Run the installer and migrate</h4>

<pre><code>rails generate paperclip_torrent:install
bundle exec rake db:migrate
</code></pre>

<h4>
<a name="include-in-your-model" class="anchor" href="#include-in-your-model"><span class="octicon octicon-link"></span></a>Include in your model</h4>

<pre><code>include PaperclipTorrent::Torrentable
</code></pre>

<p>This will add a <code>has_many torrent_files</code> association and add <code>persist_torrent_files</code> to your model's <code>after_save</code> callback.</p>

<h5>
<a name="customise" class="anchor" href="#customise"><span class="octicon octicon-link"></span></a>Customise</h5>

<p>To customise the <code>PaperclipTorrent::TorrentFileAttachment#attachment</code>, override the definition in an initializer. </p>

<p>For example:</p>

<pre><code>PaperclipTorrent::TorrentFileAttachment.attachment_definitions[:attachment][:path] = ":rails_env/:class/:hash.:extension"
PaperclipTorrent::TorrentFileAttachment.attachment_definitions[:attachment][:hash_secret] = "secret_hash_value"
</code></pre>

<h4>
<a name="retrieving-records" class="anchor" href="#retrieving-records"><span class="octicon octicon-link"></span></a>Retrieving records</h4>

<p>If your model responds to <code>torrent_results</code>, you can call <code>&lt;attachment_field&gt;.torrent_files</code> at any time to fetch available torrent keys.</p>

<p>This method will result in a hash of torrent key and file properties hash: <code>{ torrent_file: TorrentFile, dirty: boolean }</code>. </p>

<p>If the file instance is nil, you can fetch the paperclip record by calling <code>&lt;attachment_field&gt;.torrent_file(torrent_key)</code>. From here you can access the file path or URL as normal.</p>

<h2>
<a name="settings" class="anchor" href="#settings"><span class="octicon octicon-link"></span></a>Settings</h2>

<h3>
<a name="torrent-file-generation" class="anchor" href="#torrent-file-generation"><span class="octicon octicon-link"></span></a>Torrent file generation</h3>

<p>To generate a torrent file from a Paperclip style, two things are required <code>torrentify: true</code> and <code>tracker: &lt;tracker_announce_url&gt;</code></p>

<p><strong>For example,</strong> either of the following will work:</p>

<pre><code>has_attached_file :attachment, { styles: {
  audio_128kbps_44100hz: { format: 'mp3', torrentify: true }
}, 
processors: [:ffmpeg, :qtfaststart, :torrentify],
tracker: "http://tracker.mysite.com/announce" }
</code></pre>

<pre><code>has_attached_file :attachment, { styles: {
  audio_128kbps_44100hz: { format: 'mp3', torrentify: true, tracker: "http://tracker.mysite.com/announce" },
  hd_720p_16x9_5000kbps: { geometry: '1280x720', format: 'mp4', torrentify: true, tracker: "http://tracker.anothersite.com/announce" }
}, 
processors: [:ffmpeg, :qtfaststart, :torrentify] }
</code></pre>

<h3>
<a name="download-file-save-path" class="anchor" href="#download-file-save-path"><span class="octicon octicon-link"></span></a>Download file save path</h3>

<p>Using PaperclipTorrent, you can set a torrent file to save its downloaded file to either the download directory, or a sub-directory thereof.</p>

<p>By default, PaperclipTorrent is set to download the file in to a sub-directory using the default path structure: <code>:fingerprint/:style/:filename</code>.</p>

<p>To set this, in an initializer set <code>PaperclipTorrent::Config.settings[:torrent_path]</code> to any directory using the standard Paperclip directory markup.</p>

<p>Although not recommended, setting this value to nil will create the torrent file as if it is to save the file directly in the download directory.</p>

<h3>
<a name="default-values" class="anchor" href="#default-values"><span class="octicon octicon-link"></span></a>Default values</h3>

<p>The default values for the config hash are:</p>

<pre><code>PaperclipTorrent::Config.settings = {
  torrent_path: ":fingerprint/:style/:filename",
  default_piece_size: 256.kilobytes
}
</code></pre>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>MIT</p>

<p><strong>Free Software, Hell Yeah!</strong></p>
        </section>

        <footer>
          Paperclip Torrent is maintained by <a href="https://github.com/fattymiller">fattymiller</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>